<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin â€“ Student Applications</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; }
  .container {
    max-width: 1000px;
    margin: 15px auto;
    background:#fff;
    padding: 12px 15px;
    border-radius:8px;
    box-shadow:0 2px 8px rgba(0,0,0,0.2);
  }
  h1 { margin-top:0; color:#b20c0c; }
  table {
    width:100%; border-collapse: collapse; margin-top:10px; font-size:13px;
  }
  th, td {
    border:1px solid #ddd; padding:6px; text-align:left;
  }
  th { background:#eee; }
  tr:nth-child(even){ background:#fafafa; }
  button {
    padding:5px 8px; border:none; border-radius:4px;
    cursor:pointer; font-size:12px; margin:2px;
  }
  .btn-view { background:#1976d2; color:#fff; }
  .btn-approve { background:#2e7d32; color:#fff; }
  .btn-pending { background:#ffa000; color:#000; }
  .btn-reject { background:#c62828; color:#fff; }
  .msg { margin-top:6px; font-size:13px; }
  .detail-card {
    margin-top:12px;
    padding:10px;
    border-radius:6px;
    background:#fafafa;
    border:1px solid #ddd;
    font-size:14px;
  }
  .field-label { font-weight:bold; }
  a { color:#1976d2; }
</style>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>

<div class="container">
  <h1>Student Applications</h1>
  <p class="msg" id="listMsg">Loading...</p>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Roll</th>
        <th>Name</th>
        <th>Mobile</th>
        <th>Exam Level</th>
        <th>Centre</th>
        <th>Form Status</th>
        <th>Payment</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="appsBody"></tbody>
  </table>

  <div id="detailBox" class="detail-card" style="display:none;">
    <p><span class="field-label">Name:</span> <span id="dName"></span></p>
    <p><span class="field-label">Mobile:</span> <span id="dMobile"></span></p>
    <p><span class="field-label">Roll:</span> <span id="dRoll"></span></p>
    <p><span class="field-label">Exam Level:</span> <span id="dExamLevel"></span></p>
    <p><span class="field-label">Qualification:</span> <span id="dQual"></span></p>
  </div>
</div>

<script>
if(localStorage.getItem("bdsAdminLoggedIn")!=="yes"){
  location.href="login.html";
}

const sb = supabase.createClient(
  "https://yyymjhuwjvyykukfzqow.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5eW1qaHV3anZ5eWt1a2Z6cW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NzMzMjIsImV4cCI6MjA4MDI0OTMyMn0.Ja9Do4cwumTnXx2NGIRW8Ti3rKm4MBiLClQz0xjOtrQ"
);

let currentId=null;

async function loadStudents(){
  const { data, error } = await sb
    .from("students")
    .select("*")
    .order("created_at",{ascending:false});

  const body=document.getElementById("appsBody");
  body.innerHTML="";
  let i=1;

  data.forEach(st=>{
    if(!st.roll_number) return;
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i++}</td>
      <td>${st.roll_number}</td>
      <td>${st.full_name||""}</td>
      <td>${st.mobile||""}</td>
      <td><b>${st.exam_level||"-"}</b></td>
      <td>${st.exam_center||"-"}</td>
      <td>${st.form_status||"pending"}</td>
      <td>${st.payment_status||"pending"}</td>
      <td><button class="btn-view">View</button></td>
    `;
    tr.querySelector(".btn-view").onclick=()=>openDetails(st);
    body.appendChild(tr);
  });

  document.getElementById("listMsg").textContent="Loaded";
}
loadStudents();

function openDetails(st){
  currentId=st.id;
  document.getElementById("detailBox").style.display="block";
  document.getElementById("dName").textContent=st.full_name||"";
  document.getElementById("dMobile").textContent=st.mobile||"";
  document.getElementById("dRoll").textContent=st.roll_number||"";
  document.getElementById("dExamLevel").textContent=st.exam_level||"-";
  document.getElementById("dQual").textContent=st.qualification||"";
}
</script>

</body>
</html>
