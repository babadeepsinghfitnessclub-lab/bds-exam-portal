<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin â€“ Student Applications</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0}
.container{max-width:1100px;margin:15px auto;background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.2)}
h1{margin:0;color:#b20c0c}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
th,td{border:1px solid #ddd;padding:6px}
th{background:#eee}
tr:nth-child(even){background:#fafafa}
button{padding:5px 8px;border:none;border-radius:4px;cursor:pointer;font-size:12px}
.btn-view{background:#1976d2;color:#fff}
.btn-approve{background:#2e7d32;color:#fff}
.btn-pending{background:#ffa000;color:#000}
.btn-reject{background:#c62828;color:#fff}
.detail-card{margin-top:12px;padding:10px;border:1px solid #ccc;border-radius:6px;background:#fafafa}
.field-label{font-weight:bold}
.section-title{margin-top:10px;font-weight:bold;border-bottom:1px solid #ccc}
input[type=text],input[type=number]{width:100%;padding:5px}
</style>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="container">
<h1>Student Applications</h1>

<table>
<thead>
<tr>
<th>#</th>
<th>Roll</th>
<th>Name</th>
<th>Mobile</th>
<th>Exam Level</th>
<th>Centre</th>
<th>Form</th>
<th>Payment</th>
<th>Action</th>
</tr>
</thead>
<tbody id="appsBody"></tbody>
</table>

<div id="detailBox" class="detail-card" style="display:none;">
<div class="section-title">Student Details</div>

<p><span class="field-label">Name:</span> <span id="dName"></span></p>
<p><span class="field-label">Father:</span> <span id="dFather"></span></p>
<p><span class="field-label">Mobile:</span> <span id="dMobile"></span></p>
<p><span class="field-label">Roll:</span> <span id="dRoll"></span></p>
<p><span class="field-label">Exam Level:</span> <span id="dExamLevel"></span></p>
<p><span class="field-label">Qualification:</span> <span id="dQual"></span></p>

<div class="section-title">Documents</div>
<p>Photo: <a id="dPhoto" target="_blank">Open</a></p>
<p>Aadhaar Front: <a id="dAadharF" target="_blank">Open</a></p>
<p>Aadhaar Back: <a id="dAadharB" target="_blank">Open</a></p>
<p>Marksheet: <a id="dMarksheet" target="_blank">Open</a></p>
<p>Payment Screenshot: <a id="dPaymentSS" target="_blank">Open</a></p>

<div class="section-title">Payment / Form Status</div>
<button class="btn-approve" onclick="updateStatus('approved',true)">Approve</button>
<button class="btn-pending" onclick="updateStatus('pending',false)">Pending</button>
<button class="btn-reject" onclick="updateStatus('rejected',false)">Reject</button>

<div class="section-title">Exam Centre & Admit</div>
<label>Centre</label>
<input type="text" id="centerInput">
<label>Exam Date</label>
<input type="text" id="examDateInput">
<label>Shift</label>
<input type="text" id="examShiftInput">
<label><input type="checkbox" id="admitAllow"> Admit Allowed</label>
<br>
<button class="btn-approve" onclick="saveCentre()">Save Centre</button>

<div class="section-title">Result</div>
<label>Marks</label>
<input type="number" id="rMarks">
<label>Rank</label>
<input type="number" id="rRank">
<label>Status</label>
<input type="text" id="rStatus">
<label><input type="checkbox" id="rPublish"> Publish</label>
<br>
<button class="btn-approve" onclick="saveResult()">Save Result</button>

<p id="detailMsg"></p>
</div>
</div>

<script>
const sb = supabase.createClient(
"https://yyymjhuwjvyykukfzqow.supabase.co",
"YOUR_ANON_KEY"
);

let currentId=null;

function fileUrl(path){
if(!path)return "";
return sb.storage.from("student_docs").getPublicUrl(path).data.publicUrl;
}

async function loadStudents(){
const {data}=await sb.from("students").select("*").order("created_at",{ascending:false});
const body=document.getElementById("appsBody");
body.innerHTML="";
let i=1;
data.forEach(st=>{
if(!st.roll_number)return;
const tr=document.createElement("tr");
tr.innerHTML=`
<td>${i++}</td>
<td>${st.roll_number}</td>
<td>${st.full_name}</td>
<td>${st.mobile}</td>
<td>${st.exam_level||"-"}</td>
<td>${st.exam_center||"-"}</td>
<td>${st.form_status}</td>
<td>${st.payment_status}</td>
<td>
<button class="btn-view" onclick='openDetails(${JSON.stringify(st)})'>View</button>
<button class="btn-reject" onclick='deleteStudent(${st.id})'>Delete</button>
</td>`;
body.appendChild(tr);
});
}
loadStudents();

function openDetails(st){
currentId=st.id;
document.getElementById("detailBox").style.display="block";
dName.textContent=st.full_name;
dFather.textContent=st.father_name;
dMobile.textContent=st.mobile;
dRoll.textContent=st.roll_number;
dExamLevel.textContent=st.exam_level||"-";
dQual.textContent=st.qualification;

dPhoto.href=fileUrl(st.photo_path);
dAadharF.href=fileUrl(st.aadhar_front_path);
dAadharB.href=fileUrl(st.aadhar_back_path);
dMarksheet.href=fileUrl(st.marksheet_path);
dPaymentSS.href=fileUrl(st.payment_screenshot_path);

centerInput.value=st.exam_center||"";
examDateInput.value=st.exam_date||"";
examShiftInput.value=st.exam_shift||"";
admitAllow.checked=st.admit_allowed===true;

rMarks.value=st.marks||"";
rRank.value=st.rank||"";
rStatus.value=st.result_status||"";
rPublish.checked=st.result_published===true;
}

async function updateStatus(status,pay){
await sb.from("students").update({
form_status:status,
payment_status:pay?"approved":"pending"
}).eq("id",currentId);
loadStudents();
}

async function saveCentre(){
await sb.from("students").update({
exam_center:centerInput.value,
exam_date:examDateInput.value,
exam_shift:examShiftInput.value,
admit_allowed:admitAllow.checked
}).eq("id",currentId);
loadStudents();
}

async function saveResult(){
await sb.from("students").update({
marks:rMarks.value||null,
rank:rRank.value||null,
result_status:rStatus.value||null,
result_published:rPublish.checked
}).eq("id",currentId);
}

async function deleteStudent(id){
if(!confirm("Delete this form permanently?"))return;
await sb.from("students").delete().eq("id",id);
loadStudents();
}
</script>

</body>
</html>s
