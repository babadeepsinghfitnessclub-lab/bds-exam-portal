<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Form Status | BDS Mega Talent Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at top, #003f8f, #000820);
      color:#fff;
    }
    header{
      background:rgba(0,0,0,0.7);
      padding:10px 15px;
      border-bottom:2px solid #ffb400;
      text-align:center;
      font-weight:700;
      font-size:18px;
    }
    nav{
      text-align:center;
      background:rgba(0,0,0,0.5);
      padding:8px 0;
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
    }
    nav a{
      color:#ffeb99;
      text-decoration:none;
      font-size:13px;
      font-weight:bold;
    }
    nav a:hover{text-decoration:underline;}

    .container{
      max-width:600px;
      margin:20px auto 40px;
      background:rgba(0,0,0,0.6);
      padding:15px;
      border-radius:10px;
      box-shadow:0 0 15px rgba(0,0,0,0.5);
    }
    h1{
      font-size:20px;
      margin-bottom:8px;
      text-align:center;
    }
    p.small{
      font-size:13px;
      text-align:center;
      margin-bottom:12px;
      color:#ffecb3;
    }

    label{
      display:block;
      font-size:14px;
      margin-top:8px;
    }
    input{
      width:100%;
      padding:7px 9px;
      margin-top:3px;
      border-radius:6px;
      border:none;
      font-size:14px;
    }
    button{
      margin-top:12px;
      width:100%;
      padding:9px 0;
      border:none;
      border-radius:999px;
      background:#ffbf00;
      color:#000;
      font-weight:bold;
      font-size:14px;
      cursor:pointer;
    }
    button:disabled{
      opacity:.6;
      cursor:default;
    }
    #msgBox{
      margin-top:10px;
      font-size:13px;
      text-align:center;
    }

    .result-card{
      margin-top:12px;
      background:#00152f;
      border-radius:10px;
      border:1px solid #ffbf00;
      padding:10px 12px;
      font-size:14px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      margin-bottom:4px;
    }
    .row span.label{font-weight:bold;}
    footer{
      background:#000c;
      text-align:center;
      font-size:11px;
      padding:10px;
      color:#ddd;
    }
  </style>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<header>BABA DEEP SINGH MEGA TALENT HUB</header>

<nav>
  <a href="index.html">HOME</a>
  <a href="apply.html">APPLY</a>
  <a href="form-status.html">FORM STATUS</a>
  <a href="admit.html">ADMIT CARD</a>
  <a href="result.html">RESULT</a>
  <a href="download.html">DOWNLOAD</a>
  <a href="gallery.html">GALLERY</a>
  <a href="help.html">HELP</a>
  <a href="admin/login.html">ADMIN</a>
</nav>

<div class="container">
  <h1>Check Your Form Status</h1>
  <p class="small">
    Yahan Roll Number aur Date of Birth dal kar apne form ka status dekh sakte hain.
  </p>

  <label for="rollInput">Roll Number</label>
  <input type="text" id="rollInput" placeholder="Jaise: BDS260055">

  <label for="dobInput">Date of Birth</label>
  <input type="date" id="dobInput">

  <button id="btnCheck">Check Status</button>

  <div id="msgBox"></div>

  <div id="resultBox" class="result-card" style="display:none;"></div>
</div>

<footer>
  © 2026 Baba Deep Singh Mega Talent Hub
</footer>

<script>
  // Supabase client
  const sb = supabase.createClient(
    "https://yyymjhuwjvyykukfzqow.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5eW1qaHV3anZ5eWt1a2Z6cW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NzMzMjIsImV4cCI6MjA4MDI0OTMyMn0.Ja9Do4cwumTnXx2NGIRW8Ti3rKm4MBiLClQz0xjOtrQ"
  );

  const rollInput  = document.getElementById("rollInput");
  const dobInput   = document.getElementById("dobInput");
  const btnCheck   = document.getElementById("btnCheck");
  const msgBox     = document.getElementById("msgBox");
  const resultBox  = document.getElementById("resultBox");

  function showMsg(text, color){
    msgBox.textContent = text;
    msgBox.style.color = color || "#fff";
  }

  btnCheck.addEventListener("click", async ()=>{
    const roll = rollInput.value.trim().toUpperCase();
    const dob  = dobInput.value;   // yyyy-mm-dd

    resultBox.style.display = "none";
    resultBox.innerHTML = "";
    showMsg("", "#fff");

    if(!roll || !dob){
      showMsg("Roll Number aur Date of Birth dono bharna zaruri hai.","#ff8080");
      return;
    }

    btnCheck.disabled = true;
    showMsg("Please wait, record search ho raha hai...","#fff");

    try{
      // sirf zaruri columns le rahe hain – form_status, payment_status
      const { data: stu, error } = await sb
        .from("students")
        .select("full_name, father_name, roll_number, dob, form_status, payment_status")
        .eq("roll_number", roll)
        .maybeSingle();

      if(error){
        console.error(error);
        showMsg("Error: " + error.message, "#ff8080");
        btnCheck.disabled = false;
        return;
      }

      if(!stu){
        showMsg("Is Roll Number se koi record nahi mila. Roll dobara check karein.","#ff8080");
        btnCheck.disabled = false;
        return;
      }

      // DOB match check
      if(!stu.dob || stu.dob !== dob){
        showMsg("DOB match nahi ho rahi. Sahi Date of Birth enter karein.","#ff8080");
        btnCheck.disabled = false;
        return;
      }

      const formStatus  = stu.form_status  || "pending";
      const payStatus   = stu.payment_status || "pending";

      let html = "";
      html += `<div class="row"><span class="label">Name:</span><span>${stu.full_name || ""}</span></div>`;
      html += `<div class="row"><span class="label">Roll No:</span><span>${stu.roll_number || ""}</span></div>`;
      html += `<div class="row"><span class="label">Father's Name:</span><span>${stu.father_name || ""}</span></div>`;
      html += `<div class="row"><span class="label">Form Status:</span><span>${formStatus}</span></div>`;
      html += `<div class="row"><span class="label">Payment Status:</span><span>${payStatus}</span></div>`;

      resultBox.innerHTML = html;
      resultBox.style.display = "block";
      showMsg("Status successfully loaded.","#7CFC00");
      btnCheck.disabled = false;

    }catch(err){
      console.error(err);
      showMsg("Unexpected error: " + err.message,"#ff8080");
      btnCheck.disabled = false;
    }
  });
</script>

</body>
</html>
