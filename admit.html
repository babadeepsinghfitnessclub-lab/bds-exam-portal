<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admit Card | BDS Mega Talent Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      font-family:Arial, sans-serif;
      background:radial-gradient(circle at top,#1a4fff 0%,#000b33 55%,#000316 100%);
      color:#fff;
    }

    header{
      background:rgba(0,0,0,.7);
      padding:8px 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:2px solid #ffbf00;
    }
    header a{color:#fff;text-decoration:none;font-size:13px;font-weight:bold;}

    .container{
      max-width:900px;
      margin:20px auto;
      padding:0 10px;
    }
    .card{
      background:rgba(0,0,0,0.65);
      padding:14px;
      border-radius:10px;
    }

    label{font-size:14px;margin-top:6px;display:block;}
    input{
      width:100%;padding:7px;
      border:none;border-radius:6px;
      margin-top:4px;font-size:14px;
    }

    .btn {
      margin-top:10px;
      padding:9px 20px;
      border:none;
      background:#ffbf00;
      color:#000;
      font-weight:700;
      border-radius:999px;
      cursor:pointer;
    }
    .btn:disabled{opacity:0.6;}

    #msgBox{margin-top:8px;font-size:13px;}

    /* ðŸ”µ A4 PDF Layout */
    .admit-page{
      width:21cm;
      min-height:29.7cm;
      background:#fff;
      color:#000;
      padding:18px;
      border:2px solid #000;
      position:relative;
      margin-bottom:20px;
    }

    .admit-header{text-align:center;margin-bottom:10px;}
    .admit-header h2{color:#b20c0c;font-size:20px;}

    .stu-photo{
      width:110px;
      height:130px;
      border:2px solid #000;
      position:absolute;
      top:25px; right:25px;
      background-size:cover;
      background-position:center;
    }

    .row{display:flex;justify-content:space-between;font-size:14px;margin:5px 0;}
    .label{font-weight:bold;}

    /* Signature Boxes */
    .sign-area{
      margin-top:20px;
      display:flex;
      justify-content:space-between;
    }
    .sign-box{
      width:40%;
      text-align:center;
      font-size:14px;
      border-top:2px solid #000;
      padding-top:6px;
    }
    .footer-note{
      margin-top:15px;
      font-size:11px;
    }

    /* ðŸ”˜ Watermark */
    .watermark{
      position:absolute;
      top:40%;
      left:15%;
      font-size:60px;
      color:rgba(200,0,0,0.06);
      transform:rotate(-25deg);
      pointer-events:none;
    }

    #admitArea{display:none;margin-top:12px;text-align:center;}

  </style>

  <!-- CDN for PDF download -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

<header>
  <div><b>BABA DEEP SINGH MEGA TALENT HUB</b></div>
  <div>
    <a href="index.html">HOME</a>
    <a href="help.html">HELP</a>
  </div>
</header>

<div class="container">
  <div class="card">
    <h2>Download Admit Card</h2>

    <label>Roll Number</label>
    <input id="rollInput" type="text">

    <label>Date of Birth</label>
    <input id="dobInput" type="date">

    <button id="btnGet" class="btn">Get Admit Card</button>

    <div id="msgBox"></div>

    <div id="admitArea">
      <div id="admitWrap"></div>
      <button class="btn" onclick="downloadPDF()">Download Admit Card PDF</button>
    </div>

  </div>
</div>

<script>
const sb = supabase.createClient(
  "https://yyymjhuwjvyykukfzqow.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5eW1qaHV3anZ5eWt1a2Z6cW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NzMzMjIsImV4cCI6MjA4MDI0OTMyMn0.Ja9Do4cwumTnXx2NGIRW8Ti3rKm4MBiLClQz0xjOtrQ"
);

async function getAdmit(){
  let roll = rollInput.value.trim();
  let dob = dobInput.value;

  admitArea.style.display="none";
  msgBox.innerHTML="Searching...";

  const { data: st } = await sb
  .from("students")
  .select("*")
  .eq("roll_number", roll)
  .maybeSingle();

  if(!st){ msgBox.innerHTML="Invalid Roll"; return; }
  if(st.dob !== dob){ msgBox.innerHTML="DOB Wrong"; return; }
  if(st.payment_status !== "approved"){ msgBox.innerHTML="Payment Pending"; return; }
  if(!st.admit_allowed){ msgBox.innerHTML="Admit not activated"; return; }

  const photoUrl = st.photo_path ?
    sb.storage.from("student_docs").getPublicUrl(st.photo_path).data.publicUrl :
    "";

  let card = pg => `
<div class="admit-page">
  <div class="watermark">BDS EXAM</div>

  <div class="admit-header">
    <h2>Future Achievers Scholarship Exam 2026</h2>
    <div><b>EXAM ${pg==="STUDENT"?"(Student Copy)":"(Exam Cell Copy)"}</b></div>
  </div>

  <div class="stu-photo" style="background-image:url('${photoUrl}');"></div>

  <div class="row"><span class="label">Name:</span> <span>${st.full_name}</span></div>
  <div class="row"><span class="label">Father Name:</span> <span>${st.father_name}</span></div>
  <div class="row"><span class="label">Roll No:</span> <span>${st.roll_number}</span></div>
  <div class="row"><span class="label">Centre:</span> <span>${st.exam_center}</span></div>

  <div class="sign-area">
    <div class="sign-box">Student Signature</div>
    <div class="sign-box">Invigilator Signature</div>
  </div>

  <div class="footer-note">
    Carry this admit card with Aadhaar to examination center.
  </div>
</div>
`;

  admitWrap.innerHTML = card("STUDENT") + card("EXAM CELL");
  admitArea.style.display="block";
  msgBox.innerHTML="READY âœ”";
}

btnGet.onclick = getAdmit;

function downloadPDF(){
  let area = document.getElementById("admitWrap");
  html2pdf().from(area).set({
    margin: 5,
    filename: rollInput.value + "_AdmitCard.pdf",
    jsPDF: {format: 'a4', orientation: 'portrait'}
  }).save();
}
</script>

</body>
</html>
