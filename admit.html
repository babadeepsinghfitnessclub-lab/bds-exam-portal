<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admit Card | BDS Mega Talent Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:Arial, sans-serif;
      background:radial-gradient(circle at top,#1a4fff,#000d2a);
      color:#fff;
    }
    header{
      background:#000a;
      padding:8px 14px;
      border-bottom:2px solid #ffbf00;
      font-weight:bold;
    }
    nav a{
      margin-left:10px;color:#fff;text-decoration:none;
      font-size:13px;font-weight:bold;
    }
    .container{max-width:900px;margin:20px auto;padding:0 10px;}

    .card{
      background:#0007;padding:14px;
      border-radius:10px;
    }
    label{font-size:14px;margin-top:6px;display:block;}
    input{width:100%;padding:7px;border-radius:6px;font-size:14px;margin-top:3px;}
    #msgBox{margin-top:8px;font-size:13px;}

    .btn{
      margin-top:10px;padding:8px 16px;
      background:#ffbf00;border:none;
      border-radius:20px;font-size:14px;
      font-weight:bold;color:#000;cursor:pointer;
    }
    #admitBox{
      background:#fff;color:#000;
      border:2px solid #ffbf00;
      border-radius:10px;
      padding:14px;
      width:100%;
      margin-top:14px;
    }
    .admit-header{text-align:center;border-bottom:1px solid #ccc;padding-bottom:6px;margin-bottom:6px;}
    .admit-header h2{color:#b20c0c;margin-bottom:4px;}
    .row{display:flex;margin:3px 0;justify-content:space-between;font-size:13px;}
    .row b{font-weight:700;}

    .photo-box{
      width:150px;height:180px;
      border:1px solid #333;
      position:absolute;top:90px;right:18px;
      background:#eee;overflow:hidden;
    }
    .photo-box img{width:100%;height:100%;object-fit:cover;}

    .footer{text-align:center;font-size:12px;margin-top:14px;}

    footer{
      text-align:center;font-size:12px;
      padding:12px;background:#000c;margin-top:22px;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

<header>
  BABA DEEP SINGH MEGA TALENT HUB
  <nav style="display:inline;">
    <a href="index.html">HOME</a>
    <a href="apply.html">APPLY</a>
    <a href="admit.html">ADMIT CARD</a>
    <a href="result.html">RESULT</a>
  </nav>
</header>

<div class="container">
  <div class="card">
    <h1>Download Admit Card</h1>

    <label>Roll Number</label>
    <input type="text" id="rollInput" placeholder="e.g. BDS26XXXX">

    <label>Date of Birth</label>
    <input type="date" id="dobInput">

    <button class="btn" id="btnGet">Get Admit Card</button>
    <div id="msgBox"></div>

    <div id="admitBox" style="display:none;"></div>
    <button class="btn" id="btnDownload" style="display:none;">Download Admit Card (PDF)</button>

  </div>
</div>

<footer>© 2026 Baba Deep Singh Mega Talent Hub</footer>

<script>
const sb = supabase.createClient(
"YOUR_URL",
"YOUR_KEY"
);

const EXAM_NAME="Future Achievers Scholarship Exam 2026";
const EXAM_DATE="08-02-2026";
const EXAM_TIME="11:00 AM – 12:30 PM";
const REPORT_TIME="10:00 AM";

document.getElementById("btnGet").onclick = loadAdmit;
document.getElementById("btnDownload").onclick = downloadPDF;

let STUDENT_DATA=null;

async function loadAdmit(){
  const roll=document.getElementById("rollInput").value.trim().toUpperCase();
  const dob=document.getElementById("dobInput").value;
  if(!roll || !dob){show("Enter Roll No and DOB","red");return;}

  show("Loading...");
  const {data,error}= await sb.from("students")
  .select("*").eq("roll_number",roll).maybeSingle();

  if(!data){show("Record not found!","red");return;}
  if(data.dob!==dob){show("DOB mismatch!","red");return;}

  if(data.payment_status!=="approved"){
    show("Payment not verified yet.","orange");return;
  }
  if(!data.admit_allowed){show("Admit card not activated.","orange");return;}

  STUDENT_DATA=data;
  document.getElementById("btnDownload").style.display="block";

  let html=cardHTML(data,false);
  document.getElementById("admitBox").innerHTML=html;
  document.getElementById("admitBox").style.display="block";
  show("Loaded successfully!","lightgreen");
}

function cardHTML(st,centreCopy){
return `
<div style="position:relative;">
<div class='admit-header'>
<h2>${centreCopy?"EXAM CELL COPY":EXAM_NAME}</h2>
<div><b>BABA DEEP SINGH MEGA TALENT HUB</b></div>
</div>

<div class='photo-box'><img src='${fileUrl(st.photo_path)}'></div>

<div class='row'><b>Name:</b> ${st.full_name}</div>
<div class='row'><b>Father:</b> ${st.father_name}</div>
<div class='row'><b>Roll No:</b> ${st.roll_number}</div>
<div class='row'><b>Mobile:</b> ${st.mobile}</div>
<div class='row'><b>Qualification:</b> ${st.qualification}</div>
<div class='row'><b>Address:</b> ${st.address}</div>

<hr>

<div class='row'><b>Exam Date:</b> ${EXAM_DATE}</div>
<div class='row'><b>Time:</b> ${EXAM_TIME}</div>
<div class='row'><b>Reporting:</b> ${REPORT_TIME}</div>
<div class='row'><b>Centre:</b> ${st.exam_center}</div>

<div class='footer'>Watermark: BDS EXAM</div>
</div>
`;
}

function show(t,c){let m=document.getElementById("msgBox");m.style.color=c||"#fff";m.innerHTML=t;}

function fileUrl(path){
const {data}=sb.storage.from("student_docs").getPublicUrl(path);
return data.publicUrl;
}

async function downloadPDF(){
let pdf=new jsPDF('p','pt','a4');
let box=document.getElementById("admitBox");

await html2canvas(box).then(canvas=>{
pdf.addImage(canvas,'PNG',10,10,575,820);
});

let second=cardHTML(STUDENT_DATA,true);
document.getElementById("admitBox").innerHTML=second;
await html2canvas(admitBox).then(canvas=>{
pdf.addPage();
pdf.addImage(canvas,'PNG',10,10,575,820);
});

pdf.save(STUDENT_DATA.roll_number+"_AdmitCard.pdf");
document.getElementById("admitBox").innerHTML=cardHTML(STUDENT_DATA,false);
}
</script>

</body>
</html>
